---
author: ziho
pubDatetime: 2024-03-31T13:45:11.171Z
title: Hot Reload MDX 
postSlug: reload-mdx
featured: true
draft: false
tags:
  - docs
  - mdx
  - next
description: Next.js MDXì˜ ë³€ê²½ì„ ê°ì§€í•˜ê¸°
---

# next-mdx-remote

Next.jsëŠ” í•¨ê»˜ ë§ˆí¬ë‹¤ìš´/MDXë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë¬¸ì„œë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.

íŒŒì¼ ê¸°ë°˜ ë¼ìš°íŒ… ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬ `.mdx` íŒŒì¼ì„ í˜ì´ì§€ì— 1-1ë¡œ ë§¤í•‘í•  ìˆ˜ëŠ” ìˆì§€ë§Œ ì»¨í…ì¸ ê°€ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ë°°í¬ë¥¼ ë”°ë¡œ í•´ì¤˜ì•¼í•˜ëŠ” ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.

ì»¨í…ì¸ ì˜ ë³€í™”ê°€ ì¦ì€ í”„ë¡œì íŠ¸ì˜ ê²½ìš°, `next-mdx-remote`ë¥¼ í†µí•´ ì›ê²©ìœ¼ë¡œ MDXë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì— ëŒ€í•´ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`next-mdx-remote`ë¥¼ ì‚¬ìš©í•  ë•Œ, ì¼ë°˜ì ìœ¼ë¡œ production í™˜ê²½ì—ì„œëŠ” S3ê°™ì€ ìŠ¤í† ë¦¬ì§€ì— MDX íŒŒì¼ì„ ì €ì¥í•˜ê³  ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

ë¡œì»¬ì—ì„œ MDX íŒŒì¼ì´ Next.js í”„ë¡œì íŠ¸ ë‚´ë¶€ì— ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ Next.jsê°€ ë³€ê²½ì„ ê°ì§€í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ì„ ì†Œê°œí•˜ë ¤ê³  í•©ë‹ˆë‹¤.

# next v10 ì´ìƒ v12 ì´í•˜

## next devë¡œ ì‹¤í–‰í•˜ê³  ìˆëŠ” ê²½ìš°

í˜„ì¬ í”„ë¡œì íŠ¸ì˜ next ë²„ì „ì´ 10~12 ì‚¬ì´ë¼ë©´, `next-remote-watch` ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•´ê²°ì±…ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`next-mdx-remote` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“  HashCorp íŒ€ì—ì„œ ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì˜ ë³€ê²½ì„ ê°ì§€í•˜ì—¬ Next.jsë¥¼ Reload ì‹œì¼œì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

ì•„ë˜ì²˜ëŸ¼ `next dev` ëŒ€ì‹  `next-remote-watch`ë¡œ ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.

```json
"scripts": {
-  "start": "next dev"
+  "start": "next-remote-watch ../ë¡œì»¬íŒŒì¼ìœ„ì¹˜"
}
```

## ì»¤ìŠ¤í…€ ì„œë²„ë¡œ ì‹¤í–‰í•˜ê³  ìˆëŠ” ê²½ìš°

ì»¤ìŠ¤í…€ ì„œë²„ë¡œ Next.jsë¥¼ ì‹¤í–‰í•˜ê³  ìˆëŠ” ê²½ìš°ëŠ” ê°ìì˜ ì»¤ìŠ¤í…€ ì„œë²„ì— íŒŒì¼ ë³€ê²½ì„ ê°ì§€í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.

`next-remote-watch`ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì˜ ë³€ê²½ì„ ê°ì§€í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.

chokidar ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ë³€ê²½ì„ ê°ì§€í•˜ê³ , ë³€ê²½ì´ ê°ì§€ë˜ë©´ Next.js ì„œë²„ì˜ hotReloader.send ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ Next.js ì„œë²„ë¥¼ Reload ì‹œì¼œì¤ë‹ˆë‹¤.

```js
const express = require('express')
const chokidar = require('chokidar')
const next = require('next')

// ì´ ë¶€ë¶„ì€ next.js ì»¤ìŠ¤í…€ ì„œë²„ë§ˆë‹¤ ì„¤ì •ì´ ë‹¤ë¥¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì•„ë˜ chokidarë¡œ íŒŒì¼ ë³€ê²½ ê°ì§€í•˜ëŠ” ë¡œì§ë§Œ ì°¸ê³ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
const app = next({
  dev: true,
  port,
  hostname,
})
const handle = app.getRequestHandler()

const CONTENT_PATH = ë¡œì»¬íŒŒì¼ìœ„ì¹˜
app.prepare().then(() => {
    chokidar
      .watch(CONTENT_PATH)
      .on(
        'change',
        async () => {
          // ì£¼ì˜! next.jsì˜ server í”„ë¡œí¼í‹°ëŠ” next 13ë¶€í„° privateë¡œ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì—, next 13 ì´ìƒ ë²„ì „ì—ì„œëŠ” ì´ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
          app.server.hotReloader.send('building')
          app.server.hotReloader.send('reloadPage')
        }
      )
  }

  ... // ì»¤ìŠ¤í…€ ì„œë²„ ì„¤ì •ë“¤
  const server = express()
  server.all('*', (req, res) => handle(req, res, parse(req.url, true)))

  server.listen(port, (err) => {
    if (err) throw err
    console.log(`> Ready on http://localhost:${port}`)
  })
})
```

# next v13 ì´ìƒ

next 13 ì´ìƒë¶€í„°ëŠ” `nextApp.server`ê°€ privateë¡œ ë³€ê²½ë˜ì–´ì„œ `next-remote-watch` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„, ì§ì ‘ `app.server.hotReloader.send` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ë„ ì‚¬ìš©í•  ìˆ˜ë„ ì—†ìŠµë‹ˆë‹¤.

nextAppì˜ HotReloadë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ëŠ” ëª»í•˜ì§€ë§Œ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê°œë°œí™˜ê²½ì—ì„œë§Œ ë™ì‘í•  ì›¹ì†Œì¼“ ì„œë²„ë¥¼ ë§Œë“¤ì–´ì„œ íŒŒì¼ ë³€ê²½ì„ ê°ì§€í•˜ê³ , ë³€ê²½ì´ ê°ì§€ë˜ë©´ ì›¹ì†Œì¼“ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì•±ì— ë³€ê²½ì„ ì•Œë ¤ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

ìš°ì„  ì›¹ì†Œì¼“ ì„œë²„ë¥¼ ë§Œë“¤ì–´ì„œ íŒŒì¼ ë³€ê²½ì„ ê°ì§€í•©ë‹ˆë‹¤.

`watch-contents.js` íŒŒì¼ì„ ì•„ë˜ì²˜ëŸ¼ ë§Œë“¤ê²Œìš”.

```js
const { WebSocketServer } = require('ws');
const chokidar = require('chokidar');


const wss = new WebSocketServer({ port: 3001 });
const watchCallbacks = [];

const CONTENTS_PATH = ë¡œì»¬íŒŒì¼ìœ„ì¹˜
chokidar.watch(CONTENTS_PATH).on('change', () => {
  watchCallbacks.forEach(cb => cb());
});

wss.on('connection', function connection(ws) {
  ws.on('error', console.error);

  watchCallbacks.push(onChange);
  ws.on('close', function close() {
    const index = watchCallbacks.findIndex(onChange);
    watchCallbacks.splice(index, 1);
  });

  function onChange() {
    ws.send('refresh');
  }
});
```

ê·¸ë¦¬ê³  `next.config.js` íŒŒì¼ì— ì›¹ì†Œì¼“ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```json
"scripts": {
-  "start": "next dev",
+  "start": "concurrently \"next dev\" \"node watch-contents.js\""
},
```

ìš°ë¦¬ëŠ” ì´ì œ MDX íŒŒì¼ì˜ ë³€ê²½ì„ ê°ì§€í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆê³ , ì›¹ì†Œì¼“ì„ í†µí•´ ë³€ê²½ì„ ì „ë‹¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ì´ì œ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì „ë‹¬í•˜ê³  ìˆëŠ” ë³€ê²½ì„ ë°›ì•„ì„œ, Reload ì‹œí‚¤ë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.

`AutoRefresh.tsx` íŒŒì¼ì„ ì•„ë˜ì²˜ëŸ¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì›¹ì†Œì¼“ì„ ì—°ê²°í•˜ê³ , `refresh` ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´ Next.jsì˜ `router.reload` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ í˜ì´ì§€ë¥¼ Reload ì‹œí‚µë‹ˆë‹¤.

```tsx
import { ReactNode, useEffect } from 'react';
import { useRouter } from 'next/compat/router';

interface Props {
  children: ReactNode;
}

const isLocal = process.env.NODE_ENV === 'development'; // or ê° í”„ë¡œì íŠ¸ë§ˆë‹¤ ë¡œì»¬ í™˜ê²½ì„ íŒë‹¨í•˜ëŠ” ë°©ë²•ì´ ë‹¤ë¥¼í…Œë‹ˆ ìˆ˜ì •í•´ì£¼ì„¸ìš”.

const getLocalWsUrl = () => {
  return `ws://localhost:3001`;
};

export function AutoRefresh({ children }: Props) {
  const router = useRouter();
  useEffect(() => {
    if (isLocal) {
      const ws = new WebSocket(getLocalWsUrl());
      ws.onmessage = event => {
        if (event.data === 'refresh') {
          router?.reload();
        }
      };

      return () => {
        ws.close();
      };
    }

    return;
  }, [router]);

  return children;
}
```

`_app.tsx` íŒŒì¼ì—ì„œ `AutoRefresh` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

```tsx
...
<AutoRefresh>
  {getLayout(<Component {...pageProps} />)}
</AutoRefresh>
...
```

ì´ì œ MDX íŒŒì¼ì˜ ë³€ê²½ì„ ê°ì§€í•˜ì—¬ Next.jsë¥¼ Reload ì‹œí‚¬ ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ˜„
